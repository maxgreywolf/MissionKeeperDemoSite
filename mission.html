<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MssionKeeper Mission Viewer</title>

    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- <script type="text/javascript" src="js/map.js"></script> -->
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <!--Import foundation.css-->
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/MissionKeeperStyle.css" />
    <link rel="stylesheet" href="css/app.css" />
    <!-- Custom Scrollbar Styles  -->
    <link rel="stylesheet" href="css/style-blue.css" />
    <!--Import jQWidgets-->
    <link rel="stylesheet" href="jqwidgets/styles/jqx.base.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.dark.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.energyblue.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.black.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.arctic.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.blackberry.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.darkblue.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.energyblue.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.fresh.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.glacier.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.highcontrast.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.light.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.metro.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.metrodark.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.orange.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.office.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.shinyblack.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.summer.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-darkness.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-le-frog.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-lightness.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-overcast.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-redmond.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-smoothness.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-start.css" type="text/css" />
    <link rel="stylesheet" href="jqwidgets/styles/jqx.ui-sunny.css" type="text/css" />

    <!-- Azure Media Player Style -->
    <link href="//amp.azure.net/libs/amp/1.6.3/skins/amp-default/azuremediaplayer.min.css" rel="stylesheet">

    <!-- JWplayer  -->
    ​<script src="jwplayer-7.3.5/jwplayer.js"></script>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!--JQWidgets Scripts - Start -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="scripts/demos.js"></script>
    <!-- jQWidgets Javascript -->
    <script type="text/javascript" src="jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxwindow.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdocking.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdata.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdate.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxscheduler.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxscheduler.api.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdatetimeinput.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxpopover.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxcalendar.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxtooltip.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxcheckbox.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxlistbox.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxnumberinput.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxradiobutton.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxcombobox.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxinput.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxtextarea.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxtabs.js"></script>
    <script type="text/javascript" src="jqwidgets/globalization/globalize.js"></script>
    <script type="text/javascript" src="jqwidgets/globalization/globalize.culture.de-DE.js"></script>

    <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRl0RJms6XMDz3Bpfg0NKu0UnSAGBN_g8&libraries=visualization"></script> -->

    <!-- Azure Media Player -->
    <script src="//amp.azure.net/libs/amp/1.6.3/azuremediaplayer.min.js"></script>

    <!-- OpenTok Javascript -->
    <script src="https://static.opentok.com/v2/js/opentok.min.js"></script>

    <script type="text/javascript">

        /* Chat Combobox Array RolesList */
        var chatTarget = new Array("Everyone");

        $(document).ready(function () {
            $('#docking').jqxDocking({orientation: 'vertical', width: 250, mode: 'default', theme: 'dark'});
            $('#docking').jqxDocking('importLayout', '{"panel0": {"window0":{"collapsed":true},"window1":{"collapsed":false},"window2":{"collapsed":true},"window3":{"collapsed":true}},"orientation": "vertical"}');
            $('#docking').jqxDocking('showCollapseButton', 'window0');
            $('#docking').jqxDocking('showCollapseButton', 'window1');
            $('#docking').jqxDocking('showCollapseButton', 'window2');
            $('#docking').jqxDocking('showCollapseButton', 'window3');

            // Settings Popup
            $("#popover").jqxPopover({
                offset: {left: -50, top: 0},
                arrowOffsetValue: 50,
                title: "Settings",
                theme: 'dark',
                showCloseButton: true,
                selector: $("#settingsButton")
            });

            // Chat text entry
            $('#chatSendText').jqxTextArea({
                placeHolder: 'Enter chat text here...',
                height: 80,
                width: 200,
                minLength: 1,
                scrollBarSize: 2
            });

            // Chat submit button
            $("#btnSignal").jqxButton({theme: 'dark', width: '200', height: '25'});

            // Chat target combobox
            $("#cmbChatTargets").jqxComboBox({
                source: chatTarget,
                multiSelect: false,
                width: 200,
                height: 25,
                theme: 'dark',
                placeHolder: "Send to: Everyone"
            });
            $("#cmbChatTargets").jqxComboBox('selectItem', 'Everyone');

            // Popup Schedule Window
            $("#scheduleWindow").jqxWindow({
                height: 1100,
                width: 1650,
                theme: 'dark',
                isModal: true,
                autoOpen: false,
                position: {x: 0, y: 0}
            });

            $('#scheduleWindow').on('open', function (event) {
                var uriMissions = "http://missionkeeperdemoapi.azurewebsites.net/api/missions";

                $.getJSON(uriMissions, function(missionsData)  {

                    //setupCurrentMissions(missionsData);

                    setupSchedule(missionsData);
                });
            });
        });

    </script>

    <script>

        var geocoder;
        var maptwo;

        var inviteeName_1;
        var inviteeEmail_1;
        var inviteeRole_1;

        var inviteeName_2;
        var inviteeEmail_2;
        var inviteeRole_2;

        var inviteeName_3;
        var inviteeEmail_3;
        var inviteeRole_3;

        var inviteeName_4;
        var inviteeEmail_4;
        var inviteeRole_4;

        var inviteeName_5;
        var inviteeEmail_5;
        var inviteeRole_5;

        var inviteeName_6;
        var inviteeEmail_6;
        var inviteeRole_6;

        function setupSchedule(missionsData) {

            var missions = new Array();

            $.each( missionsData, function( index, value ) {

                var tComex = parseJsonDate( value.Comex );
                var tFinex = parseJsonDate( value.Finex );

                var tBkgrdColor;

                switch ( value.Type ) {
                    case 0:
                        tBkgrdColor = '#FF0000';
                        break;
                    case 1:
                        tBkgrdColor = '#0000FF';
                        break;
                    case 2:
                        tBkgrdColor = '#00FF00';
                        break;
                    case 3:
                        tBkgrdColor = '#00F0F0';
                        break;
                }

                if ( ! value.IsHidden) {

                    var tMission = {
                        id: value.ID,
                        description: value.Description,
                        location: value.Location,
                        subject: value.Name,
                        calendar: "My Missions",
                        start: tComex,
                        end: tFinex,
                        background: tBkgrdColor
                    };

                    missions.push(tMission);
                }

            });

            // prepare the data
            var source =
            {
                dataType: "array",
                dataFields: [
                    { name: 'id', type: 'string' },
                    { name: 'description', type: 'string' },
                    { name: 'location', type: 'string' },
                    { name: 'subject', type: 'string' },
                    { name: 'calendar', type: 'string' },
                    { name: 'start', type: 'date' },
                    { name: 'end', type: 'date' },
                    { name: 'background', type: 'string' }
                ],
                id: 'id',
                localData: missions
            };
            var adapter = new $.jqx.dataAdapter(source);

            $("#scheduler").jqxScheduler({
                date: new $.jqx.date('todayDate'),
                width: 1870,
                height: 890,
                maxWidth: 1870,
                maxHeight: 890,
                source: adapter,
                showLegend: false,
                theme: 'energyblue',
                editDialogCreate: function (dialog, fields, editAppointment) {
                    // hide repeat option
                    fields.repeatContainer.hide();
                    // hide description option
                    fields.descriptionContainer.hide();
                    // hide All Day option
                    fields.allDayContainer.hide();
                    // hide status option
                    fields.statusContainer.hide();
                    // hide timeZone option
                    fields.timeZoneContainer.hide();
                    // hide location option
                    fields.locationContainer.hide();
                    // hide color option
                    fields.colorContainer.hide();
                    fields.subjectLabel.html("Mission Name");
                    //fields.locationLabel.html("Location");
                    fields.fromLabel.html("Start");
                    fields.toLabel.html("End");
                    fields.resourceLabel.html("Mission Type");

                    // add custom print button.
                    printButton = $("<button style='margin-left: 5px; float:right;'>Print</button>");
                    fields.buttons.append(printButton);
                    printButton.jqxButton({ theme: this.theme });
                    printButton.click(function () {
                        var appointment = editAppointment;
                        if (!appointment)
                            return;
                        var appointmentContent =
                                "<table class='printTable'>" +
                                "<tr>" +
                                "<td class='label'>Title</td>" +
                                "<td>" + fields.subject.val() + "</td>" +
                                "</tr>" +
                                "<tr>" +
                                "<td class='label'>Start</td>" +
                                "<td>" + fields.from.val() + "</td>" +
                                "</tr>" +
                                "<tr>" +
                                "<td class='label'>End</td>" +
                                "<td>" + fields.to.val() + "</td>" +
                                "</tr>" +
                                "<tr>" +
                                "<td class='label'>Where</td>" +
                                "<td>" + fields.location.val() + "</td>" +
                                "</tr>" +
                                "<tr>" +
                                "<td class='label'>Calendar</td>" +
                                "<td>" + fields.resource.val() + "</td>" +
                                "</tr>"
                                + "</table>";
                        var newWindow = window.open('', '', 'width=800, height=500'),
                                document = newWindow.document.open(),
                                pageContent =
                                        '<!DOCTYPE html>\n' +
                                        '<html>\n' +
                                        '<head>\n' +
                                        '<meta charset="utf-8" />\n' +
                                        '<title>jQWidgets Scheduler</title>\n' +
                                        '<style>\n' +
                                        '.printTable {\n' +
                                        'border-color: #aaa;\n' +
                                        '}\n' +
                                        '.printTable .label {\n' +
                                        'font-weight: bold;\n' +
                                        '}\n' +
                                        '.printTable td{\n' +
                                        'padding: 4px 3px;\n' +
                                        'border: 1px solid #DDD;\n' +
                                        'vertical-align: top;\n' +
                                        '}\n' +
                                        '</style>' +
                                        '</head>\n' +
                                        '<body>\n' + appointmentContent + '\n</body>\n</html>';
                        try
                        {
                            document.write(pageContent);
                            document.close();
                        }
                        catch (error) {
                        }
                        newWindow.print();
                    });

                    // var qwerty = fields.location[0];
                    // qwerty.setValue( "Fuck" );

                },
                /**
                 * called when the dialog is opened. Returning true as a result disables the built-in handler.
                 * @param {Object} dialog - jqxWindow's jQuery object.
                 * @param {Object} fields - Object with all widgets inside the dialog.
                 * @param {Object} the selected appointment instance or NULL when the dialog is opened from cells selection.
                 */
                editDialogOpen: function (dialog, fields, editAppointment) {

                    // hide repeat option
                    fields.repeatContainer.hide();

                    if (!editAppointment && printButton) {
                        printButton.jqxButton({ disabled: true });
                    }
                    else if (editAppointment && printButton) {
                        printButton.jqxButton({ disabled: false });
                    }
                },
                /**
                 * called when the dialog is closed.
                 * @param {Object} dialog - jqxWindow's jQuery object.
                 * @param {Object} fields - Object with all widgets inside the dialog.
                 * @param {Object} the selected appointment instance or NULL when the dialog is opened from cells selection.
                 */
                editDialogClose: function (dialog, fields, editAppointment) {
                },
                /**
                 * called when a key is pressed while the dialog is on focus. Returning true or false as a result disables the built-in keyDown handler.
                 * @param {Object} dialog - jqxWindow's jQuery object.
                 * @param {Object} fields - Object with all widgets inside the dialog.
                 * @param {Object} the selected appointment instance or NULL when the dialog is opened from cells selection.
                 * @param {jQuery.Event Object} the keyDown event.
                 */
                editDialogKeyDown: function (dialog, fields, editAppointment, event) {
                },
                ready: function () {
                    $("#scheduler").jqxScheduler('scrollTop', 200);
                },
                appointmentDataFields:
                {
                    from: "start",
                    to: "end",
                    id: "id",
                    description: "description",
                    location: "location",
                    subject: "subject",
                    background: "background",
                    resourceId: "calendar"
                },
                view: 'weekView',
                views:
                        [
                            'dayView',
                            'weekView',
                            'monthView'
                        ]
            });

            $('#scheduler').on('appointmentAdd', function (event) {

                var args = event.args;
                var appointment = args.appointment;

            });

            $("#scheduler").jqxScheduler('ensureVisible',  new $.jqx.date(), missionsData[2].ID );

            //*********************Start Testing Customizing the Appointment Dialog********************
            $("#scheduler").on('editDialogCreate', function(dialog, fields, editAppointment){

                var MapLocation = "";
                var ApptTabSet = "";

                ApptTabSet += "<div id='tabSet'>";
                ApptTabSet += "<div id='jqxtabs'>";
                ApptTabSet += "<ul style='margin-left: 20px;'>";
                ApptTabSet += "<li>Locate</li>";
                ApptTabSet += "<li>Invite</li>";
                ApptTabSet += "<li>Insure</li>";
                ApptTabSet += "<li>COA</li>";
                ApptTabSet += "</ul>";
                ApptTabSet += "<div style='overflow: hidden; height: 350px;'>";
                ApptTabSet += "<div id='InviteMap' class='appointmentMap' style='text-align: center;'><img src='img/USmap.png' id='mapPlacesetter' /></div>";
                ApptTabSet += "<input type='text' id='Location1' />";
                ApptTabSet += "<input type='button' id='mapit' style='margin-top: 4px;' value='Click to map the location.' />";
                ApptTabSet += "</div>";
                // Invite
                ApptTabSet += "<div class='TabContentDiv' style='overflow: hidden; height: 350px;'>Add Mission Invitees Below";
                ApptTabSet += "<table id='InviteeTable'>";
                ApptTabSet += "<tr class='inviteeRow' id='InviteeRow_1' style='visibility: visible;'>";
                ApptTabSet += "<td class='InviteeFieldName'><input type='text' class='inviteeName' id='InviteeName_1'/></td>";
                ApptTabSet += "<td class='InviteeFieldEmail'><input type='text' class='inviteeEmail' id='InviteeEmail_1'/></td>";
                ApptTabSet += "<td class='InviteeFieldRole'><div class='inviteeRole' id='cmbRole_1' style='float: right; margin: 0px;'></div></td>";
                ApptTabSet += "<td class='InviteeFieldAdd'><input type='button' id='addInvitee_1' value='+' style='float: right; margin: 0px;' /></td>";
                ApptTabSet += "</tr>";
                ApptTabSet += "<tr class='inviteeRow' id='InviteeRow_2' style='visibility: visible;'>";
                ApptTabSet += "<td class='InviteeFieldName'><input type='text' class='inviteeName' id='InviteeName_2'/></td>";
                ApptTabSet += "<td class='InviteeFieldEmail'><input type='text' class='inviteeEmail' id='InviteeEmail_2'/></td>";
                ApptTabSet += "<td class='InviteeFieldRole'><div class='inviteeRole' id='cmbRole_2' style='float: right; margin: 0px;'></div></td>";
                ApptTabSet += "<td class='InviteeFieldAdd'><input type='button' id='addInvitee_2' value='+' style='float: right; margin: 0px;' /></td>";
                ApptTabSet += "</tr>";
                ApptTabSet += "<tr class='inviteeRow' id='InviteeRow_3' style='visibility: visible;'>";
                ApptTabSet += "<td class='InviteeFieldName'><input type='text' class='inviteeName' id='InviteeName_3'/></td>";
                ApptTabSet += "<td class='InviteeFieldEmail'><input type='text' class='inviteeEmail' id='InviteeEmail_3'/></td>";
                ApptTabSet += "<td class='InviteeFieldRole'><div class='inviteeRole' id='cmbRole_3' style='float: right; margin: 0px;'></div></td>";
                ApptTabSet += "<td class='InviteeFieldAdd'><input type='button' id='addInvitee_3' value='+' style='float: right; margin: 0px;' /></td>";
                ApptTabSet += "</tr>";
                ApptTabSet += "<tr class='inviteeRow' id='InviteeRow_4' style='visibility: visible;'>";
                ApptTabSet += "<td class='InviteeFieldName'><input type='text' class='inviteeName' id='InviteeName_4'/></td>";
                ApptTabSet += "<td class='InviteeFieldEmail'><input type='text' class='inviteeEmail' id='InviteeEmail_4'/></td>";
                ApptTabSet += "<td class='InviteeFieldRole'><div class='inviteeRole' id='cmbRole_4' style='float: right; margin: 0px;'></div></td>";
                ApptTabSet += "<td class='InviteeFieldAdd'><input type='button' id='addInvitee_4' value='+' style='float: right; margin: 0px;' /></td>";
                ApptTabSet += "</tr>";
                ApptTabSet += "<tr class='inviteeRow' id='InviteeRow_5' style='visibility: visible;'>";
                ApptTabSet += "<td class='InviteeFieldName'><input type='text' class='inviteeName' id='InviteeName_5'/></td>";
                ApptTabSet += "<td class='InviteeFieldEmail'><input type='text' class='inviteeEmail' id='InviteeEmail_5'/></td>";
                ApptTabSet += "<td class='InviteeFieldRole'><div class='inviteeRole' id='cmbRole_5' style='float: right; margin: 0px;'></div></td>";
                ApptTabSet += "<td class='InviteeFieldAdd'><input type='button' id='addInvitee_5' value='+' style='float: right; margin: 0px;' /></td>";
                ApptTabSet += "</tr>";
                ApptTabSet += "<tr class='inviteeRow' id='InviteeRow_6' style='visibility: visible;'>";
                ApptTabSet += "<td class='InviteeFieldName'><input type='text' class='inviteeName' id='InviteeName_6'/></td>";
                ApptTabSet += "<td class='InviteeFieldEmail'><input type='text' class='inviteeEmail' id='InviteeEmail_6'/></td>";
                ApptTabSet += "<td class='InviteeFieldRole'><div class='inviteeRole' id='cmbRole_6' style='float: right; margin: 0px;'></td>";
                ApptTabSet += "<td class='InviteeFieldAdd'><input type='button' id='addInvitee_6' value='+' style='float: right; margin: 0px;' /></td>";
                ApptTabSet += "</tr>";
                ApptTabSet += "</table>";
                ApptTabSet += "</div>";
                // Insure
                ApptTabSet += "<div style='overflow: hidden; height: 350px;'>";
                ApptTabSet += "Insurance Info";
                ApptTabSet += "<input type='text' class='appointmentField' id='InsPolicyNumber' value='8759264-852-41' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='InsCarrier' value='Travers & Associates' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='InsName' value='Bill Samuels' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='InsPhone' value='(213) 555-4186' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='InsEmail' value='Bill.Samuels@traversaviation.com' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "</div>";
                // COA
                ApptTabSet += "<div style='overflow: hidden; height: 350px;'>";
                ApptTabSet += "<div style='width: 40%; float: left;'>";
                ApptTabSet += "<input type='text' class='appointmentField' id='COANumber' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='Platform' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='Altitude' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='PilotInCharge' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='Observer_1' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='Observer_2' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='Frequencies' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "</div>";
                ApptTabSet += "<div style='width: 60%; float: right;'>";
                ApptTabSet += "<input type='text' class='appointmentField' id='FlightTime' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='ContingencyProcedures' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='Hazards' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='LawEnforcement' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='EMT' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "<input type='text' class='appointmentField' id='LostLink_Flyaway' style='margin: 4px 0 0 0;' />";
                ApptTabSet += "</div>";
                ApptTabSet += "<div style='width: 100%; float: left; margin-top: 4px'>";
                ApptTabSet += "<textarea class='appointmentField' id='MissionOverview' style='color: black; margin: 4px 0 0 0;' />";
                ApptTabSet += "</div>";
                ApptTabSet += "</div>";
                ApptTabSet += "</div>";
                ApptTabSet += "</div>";

                /*
                 Policy number”
                 “Expiration Date”
                 “Carrier”
                 "insurance contact info”
                 this would be the name
                 phone number
                 email address of the insurance broker or carrier.
                 COA Number 					114
                 Platform 					118WP
                 Location 					NCSU Butner Beef Cattle Farm
                 Altitude 					400'
                 Pilot in Charge 				Kevin Franklin
                 Observer #1 					Mark Carter
                 Observer #2 					N/A
                 Mission Overview 				Test of new IR camera
                 Frequencies to be Used 				2.4   122.8
                 Planned Flight Time 				10 Minutes
                 Contingency Procedures 				Home
                 Hazards unique to the flight being flown 	No Wind
                 Emergency Contact - Law Enforcement 		911
                 Emergency Contact - EMT 			911
                 Emergency Contact - Lost Link/Flyaway 		RDU Approach   919-840-7700*/

                var i = 0;

                $('#dialogscheduler').children('div').each(function () { // loop trough the div's (only first level childs) elements in dialogscheduler
                    //var subjectInput = document.getElementById("jqxWidgetdaf6f1e9");
                    //subjectInput('val','Whatup');
                    i += 1;
                    if (i == 4) { // places the field in the third position.
                        $(this).after(ApptTabSet);
                        //$(this).after(MapLocation);
                    }
                    if (i == 5) { // places the field in the sixth position.
                        //$(this).after(Platform);
                    }
                    if (i == 5) { // places the field in the sixth position.
                        //$(this).after(Operator);
                    }
                    if (i == 9) { // places the field in the sixth position.
                        //$(this).after(Sensor);
                        return false; // exits the loop
                    }
                });

                /* Chat Combobox Array RolesList */
                var RolesList = ["Administrator", "Participant", "Observer", "Operator"];

                $('#COANumber').jqxInput({ width: 125, height: 25, placeHolder: 'COA Number', theme: 'energyblue' });
                $('#Platform').jqxInput({ width: 125, height: 25, placeHolder: 'Platform', theme: 'energyblue' });
                $('#Altitude').jqxInput({ width: 125, height: 25, placeHolder: 'Altitude', theme: 'energyblue' });
                $('#PilotInCharge').jqxInput({ width: 125, height: 25, placeHolder: 'Pilot in Charge', theme: 'energyblue' });
                $('#Observer_1').jqxInput({ width: 125, height: 25, placeHolder: 'Observer #1', theme: 'energyblue' });
                $('#Observer_2').jqxInput({ width: 125, height: 25, placeHolder: 'Observer #2', theme: 'energyblue' });
                $('#MissionOverview').jqxTextArea({ width: '99%', height: 75, placeHolder: 'Mission Overview', scrollBarSize: 5, theme: 'energyblue' });
                $('#Frequencies').jqxInput({ width: 125, height: 25, placeHolder: 'Frequencies', theme: 'energyblue' });
                $('#FlightTime').jqxInput({ width: '95%', height: 25, placeHolder: 'Planned Flight Time', theme: 'energyblue' });
                $('#ContingencyProcedures').jqxInput({ width: '95%', height: 25, placeHolder: 'Contingency Procedures', theme: 'energyblue' });
                $('#Hazards').jqxInput({ width: '95%', height: 25, placeHolder: 'Hazards to Flight being Flown', theme: 'energyblue' });
                $('#LawEnforcement').jqxInput({ width: '95%', height: 25, placeHolder: 'Emergency # - Police', theme: 'energyblue' });
                $('#EMT').jqxInput({ width: '95%', height: 25, placeHolder: 'Emergency # - EMT', theme: 'energyblue' });
                $('#LostLink_Flyaway').jqxInput({ width: '95%', height: 25, placeHolder: 'Emergency # - Flyaway', theme: 'energyblue' });

                $('#InsPolicyNumber').jqxInput({ width: '95%', height: 25, placeHolder: 'Policy Number', theme: 'energyblue' });
                $('#InsCarrier').jqxInput({ width: '95%', height: 25, placeHolder: 'Carrier Name', theme: 'energyblue' });
                $('#InsName').jqxInput({ width: '95%', height: 25, placeHolder: 'Contact Name', theme: 'energyblue' });
                $('#InsPhone').jqxInput({ width: '95%', height: 25, placeHolder: 'Phone Number', theme: 'energyblue' });
                $('#InsEmail').jqxInput({ width: '95%', height: 25, placeHolder: 'Email Address', theme: 'energyblue' });

                $('#Location1').jqxInput({ width: '100%', height: 25, placeHolder: 'Mission Address', theme: 'energyblue' });
                $('#InviteeName_1').jqxInput({ width: 70, height: 25, placeHolder: 'Name', theme: 'energyblue' });
                $('#InviteeEmail_1').jqxInput({ width: 130, height: 25, placeHolder: 'Email Address', theme: 'energyblue' });
                $('#cmbRole_1').jqxComboBox({source: RolesList, multiSelect: false, width: 110, height: 25, theme: 'energyblue', placeHolder: "Select Role"});
                $('#addInvitee_1').jqxButton({ width: 20, height: 25, theme: 'energyblue' });

                $('#InviteeName_2').jqxInput({ width: 70, height: 25, placeHolder: 'Name', theme: 'energyblue' });
                $('#InviteeEmail_2').jqxInput({ width: 130, height: 25, placeHolder: 'Email Address', theme: 'energyblue' });
                $('#cmbRole_2').jqxComboBox({source: RolesList, multiSelect: false, width: 110, height: 25, theme: 'energyblue', placeHolder: "Select Role"});
                $('#addInvitee_2').jqxButton({ width: 20, height: 25, theme: 'energyblue' });

                $('#InviteeName_3').jqxInput({ width: 70, height: 25, placeHolder: 'Name', theme: 'energyblueenergyblue' });
                $('#InviteeEmail_3').jqxInput({ width: 130, height: 25, placeHolder: 'Email Address', theme: 'energyblue' });
                $('#cmbRole_3').jqxComboBox({source: RolesList, multiSelect: false, width: 110, height: 25, theme: 'energyblue', placeHolder: "Select Role"});
                $('#addInvitee_3').jqxButton({ width: 20, height: 25, theme: 'energyblue' });

                $('#InviteeName_4').jqxInput({ width: 70, height: 25, placeHolder: 'Name', theme: 'energyblue' });
                $('#InviteeEmail_4').jqxInput({ width: 130, height: 25, placeHolder: 'Email Address', theme: 'energyblue' });
                $('#cmbRole_4').jqxComboBox({source: RolesList, multiSelect: false, width: 110, height: 25, theme: 'energyblue', placeHolder: "Select Role"});
                $('#addInvitee_4').jqxButton({ width: 20, height: 25, theme: 'energyblue' });

                $('#InviteeName_5').jqxInput({ width: 70, height: 25, placeHolder: 'Name', theme: 'energyblue' });
                $('#InviteeEmail_5').jqxInput({ width: 130, height: 25, placeHolder: 'Email Address', theme: 'energyblue' });
                $('#cmbRole_5').jqxComboBox({source: RolesList, multiSelect: false, width: 110, height: 25, theme: 'energyblue', placeHolder: "Select Role"});
                $('#addInvitee_5').jqxButton({ width: 20, height: 25, theme: 'energyblue' });

                $('#InviteeName_6').jqxInput({ width: 70, height: 25, placeHolder: 'Name', theme: 'energyblue' });
                $('#InviteeEmail_6').jqxInput({ width: 130, height: 25, placeHolder: 'Email Address', theme: 'energyblue' });
                $('#cmbRole_6').jqxComboBox({source: RolesList, multiSelect: false, width: 110, height: 25, theme: 'energyblue', placeHolder: "Select Role"});
                $('#addInvitee_6').jqxButton({ width: 20, height: 25, theme: 'energyblue' });

                $("#InviteeRow_2").toggle();
                $("#InviteeRow_3").toggle();
                $("#InviteeRow_4").toggle();
                $("#InviteeRow_5").toggle();
                $("#InviteeRow_6").toggle();

                /* var inviteeName_1;
                 var inviteeEmail_1;
                 var inviteeRole_1; */

                $('#InviteeName_1').on('change',
                        function (event) {
                            inviteeName_1 = $('#InviteeName_1').val();
                        });

                $('#InviteeEmail_1').on('change',
                        function (event) {
                            inviteeEmail_1 = $('#InviteeEmail_1').val();
                        });

                $('#cmbRole_1').on('change',
                        function (event) {
                            var args = event.args;
                            if (args) {
                                // index represents the item's index.
                                var item = args.item;
                                inviteeRole_1 = item.value;
                            }
                        });

                $('#InviteeName_2').on('change',
                        function (event) {
                            inviteeName_2 = $('#InviteeName_2').val();
                        });

                $('#InviteeEmail_2').on('change',
                        function (event) {
                            inviteeEmail_2 = $('#InviteeEmail_2').val();
                        });

                $('#cmbRole_2').on('change',
                        function (event) {
                            var args = event.args;
                            if (args) {
                                // index represents the item's index.
                                var item = args.item;
                                inviteeRole_2 = item.value;
                            }
                        });

                $('#InviteeName_3').on('change',
                        function (event) {
                            inviteeName_3 = $('#InviteeName_3').val();
                        });

                $('#InviteeEmail_3').on('change',
                        function (event) {
                            inviteeEmail_3 = $('#InviteeEmail_3').val();
                        });

                $('#cmbRole_3').on('change',
                        function (event) {
                            var args = event.args;
                            if (args) {
                                // index represents the item's index.
                                var item = args.item;
                                inviteeRole_3 = item.value;
                            }
                        });

                $('#InviteeName_4').on('change',
                        function (event) {
                            inviteeName_4 = $('#InviteeName_4').val();
                        });

                $('#InviteeEmail_4').on('change',
                        function (event) {
                            inviteeEmail_4 = $('#InviteeEmail_4').val();
                        });

                $('#cmbRole_4').on('change',
                        function (event) {
                            var args = event.args;
                            if (args) {
                                // index represents the item's index.
                                var item = args.item;
                                inviteeRole_4 = item.value;
                            }
                        });

                $('#InviteeName_5').on('change',
                        function (event) {
                            inviteeName_5 = $('#InviteeName_5').val();
                        });

                $('#InviteeEmail_5').on('change',
                        function (event) {
                            inviteeEmail_5 = $('#InviteeEmail_5').val();
                        });

                $('#cmbRole_5').on('change',
                        function (event) {
                            var args = event.args;
                            if (args) {
                                // index represents the item's index.
                                var item = args.item;
                                inviteeRole_5 = item.value;
                            }
                        });

                $('#InviteeName_6').on('change',
                        function (event) {
                            inviteeName_6 = $('#InviteeName_6').val();
                        });

                $('#InviteeEmail_6').on('change',
                        function (event) {
                            inviteeEmail_6 = $('#InviteeEmail_6').val();
                        });

                $('#cmbRole_6').on('change',
                        function (event) {
                            var args = event.args;
                            if (args) {
                                // index represents the item's index.
                                var item = args.item;
                                inviteeRole_6 = item.value;
                            }
                        });

                $('#scheduler').on('appointmentAdd',
                        function (event) {
                            var args = event.args;
                            var mAppointment = args.appointment;
                            var mMissionID = "a0914d13-797e-49e1-9500-68553b61749e";

                            var mSubject = mAppointment.subject;
                            var mStart = mAppointment.from;
                            var mEnd = mAppointment.to;

                            if (inviteeName_1 && inviteeEmail_1 && inviteeRole_1) {

                                var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + mMissionID + "/username/" + inviteeName_1 + "/role/" + inviteeRole_1 + "/email/" + inviteeEmail_1 + "/";

                                $.getJSON(uriInviteEmail, function (result) {
                                    console.log("Invitation : " + result);
                                });

                                inviteeName_1 = "";
                                inviteeEmail_1 = "";
                                inviteeRole_1 = "";
                            }

                            if (inviteeName_2 && inviteeEmail_2 && inviteeRole_2) {

                                var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + mMissionID + "/username/" + inviteeName_2 + "/role/" + inviteeRole_2 + "/email/" + inviteeEmail_2 + "/";

                                $.getJSON(uriInviteEmail, function (result) {
                                    console.log("Invitation : " + result);
                                });

                                inviteeName_2 = "";
                                inviteeEmail_2 = "";
                                inviteeRole_2 = "";
                            }

                            if (inviteeName_3 && inviteeEmail_3 && inviteeRole_3) {

                                var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + mMissionID + "/username/" + inviteeName_3 + "/role/" + inviteeRole_3 + "/email/" + inviteeEmail_3 + "/";

                                $.getJSON(uriInviteEmail, function (result) {
                                    console.log("Invitation : " + result);
                                });

                                inviteeName_3 = "";
                                inviteeEmail_3 = "";
                                inviteeRole_3 = "";
                            }

                            if (inviteeName_4 && inviteeEmail_4 && inviteeRole_4) {

                                var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + mMissionID + "/username/" + inviteeName_4 + "/role/" + inviteeRole_4 + "/email/" + inviteeEmail_4 + "/";

                                $.getJSON(uriInviteEmail, function (result) {
                                    console.log("Invitation : " + result);
                                });

                                inviteeName_4 = "";
                                inviteeEmail_4 = "";
                                inviteeRole_4 = "";
                            }

                            if (inviteeName_5 && inviteeEmail_5 && inviteeRole_5) {

                                var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + mMissionID + "/username/" + inviteeName_5 + "/role/" + inviteeRole_5 + "/email/" + inviteeEmail_5 + "/";

                                $.getJSON(uriInviteEmail, function (result) {
                                    console.log("Invitation : " + result);
                                });

                                inviteeName_5 = "";
                                inviteeEmail_5 = "";
                                inviteeRole_5 = "";
                            }

                            if (inviteeName_6 && inviteeEmail_6 && inviteeRole_6) {

                                var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + mMissionID + "/username/" + inviteeName_6 + "/role/" + inviteeRole_6 + "/email/" + inviteeEmail_6 + "/";

                                $.getJSON(uriInviteEmail, function (result) {
                                    console.log("Invitation : " + result);
                                });

                                inviteeName_6 = "";
                                inviteeEmail_6 = "";
                                inviteeRole_6 = "";
                            }
                        });

                $('#addInvitee_1').on('click', function () {
                    var mInviteeRow_2 = $("#InviteeRow_2");
                    mInviteeRow_2.toggle();
                    $('#addInvitee_1').toggle();
                });

                $('#addInvitee_2').on('click', function () {
                    var mInviteeRow_3 = $("#InviteeRow_3");
                    mInviteeRow_3.toggle();
                    $('#addInvitee_2').toggle();
                });

                $('#addInvitee_3').on('click', function () {
                    var mInviteeRow_4 = $("#InviteeRow_4");
                    mInviteeRow_4.toggle();
                    $('#addInvitee_3').toggle();
                });

                $('#addInvitee_4').on('click', function () {
                    var mInviteeRow_5 = $("#InviteeRow_5");
                    mInviteeRow_5.toggle();
                    $('#addInvitee_4').toggle();
                });

                $('#addInvitee_5').on('click', function () {
                    var mInviteeRow_6 = $("#InviteeRow_6");
                    mInviteeRow_6.toggle();
                    $('#addInvitee_5').toggle();
                });

                $('#addInvitee_6').on('click', function () {
                    var mInviteeRow_2 = $("#InviteeRow_2");
                    mInviteeRow_2.toggle();
                    $('#addInvitee_6').toggle();
                });

                $('#jqxtabs').jqxTabs({width: '100%', theme: 'energyblue'});
                $('#mapit').jqxButton({ width: '100%', height: 25, theme: 'energyblue' });

                $('#mapit').on('click', function () {
                    var mapTarget = document.getElementById('InviteMap');
                    var address = document.getElementById("Location1").value;
                    var geocoder = new google.maps.Geocoder();


                    maptwo = new google.maps.Map(mapTarget, {
                        zoom: 16,
                        center: {lat:36.586246, lng:-79.391800},
                        mapTypeId: google.maps.MapTypeId.TERRAIN
                    });

                    geocoder.geocode( { 'address': address}, function(results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            maptwo.setCenter(results[0].geometry.location);
                            var marker = new google.maps.Marker({
                                map: maptwo,
                                position: results[0].geometry.location
                            });
                        } else {
                            alert("Geocode was not successful for the following reason: " + status);
                        }
                    });
                });


            });
            //*********************End Testing Customizing the Appointment Dialog********************

            //************************Start Mapit Button*******************************

            /*
             function codeAddress() {
             var address = document.getElementById("Location1").value;
             geocoder.geocode( { 'address': address}, function(results, status) {
             if (status == google.maps.GeocoderStatus.OK) {
             map.setCenter(results[0].geometry.location);
             var marker = new google.maps.Marker({
             map: map,
             position: results[0].geometry.location
             });
             } else {
             alert("Geocode was not successful for the following reason: " + status);
             }
             });
             }
             */


            //*********************Start
            $("#scheduler").on('editDialogOpen', function(event){
                var args = event.args;
                var appointment = args.appointment;

                if (appointment) {
                    $('#Operator').val(appointment.Name);
                    $('#Platform').val(appointment.LastName);
                    $('#Sensor1').val(appointment.LastName);
                } else{
                    $('#Operator').val('');
                    $('#Platform').val('');
                    $('#Sensor1').val('');
                }
            });
            //**********End

            //**************Start
            $("#scheduler").on('appointmentChange', function (event) {
                var args = event.args;
                var appointment = args.appointment;

                appointment.Name = $("#Operator").val();
                appointment.LastName = $("#Platform").val();
                appointment.LastName = $("#Sensor1").val();
            });
            //************End
        }

        function setupCurrentMissions(missionsData) {

            var lstMissions = document.getElementById("missions");



            var items = [];
            $.each( missionsData, function( index, value ) {


                if(! value.IsHidden ) {

                    var uriVal = 'mission.html?name=' + value.Name + '&ID=' + value.ID;

                    var liTag = document.createElement("li");
                    var aTag = document.createElement("a");
                    aTag.className += " missionLinks";

                    aTag.setAttribute('href', uriVal);
                    aTag.innerHTML = value.Name + " Mission";

                    liTag.appendChild(aTag);
                    lstMissions.appendChild(liTag);
                }

            } );
        }

        function parseJsonDate(jsonDateString){
            return new Date(parseInt(jsonDateString.replace('/Date(', '')));
        }


        /*function initialize() {
         geocoder = new google.maps.Geocoder();
         var latlng = new google.maps.LatLng(-34.397, 150.644);
         var mapOptions = {
         zoom: 8,
         center: latlng
         }
         map = new google.maps.Map(document.getElementById("map"), mapOptions);
         }*/

        function codeAddress() {
            var address = document.getElementById("Location1").value;
            geocoder.geocode( { 'address': address}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    maptwo.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: maptwo,
                        position: results[0].geometry.location
                    });
                } else {
                    alert("Geocode was not successful for the following reason: " + status);
                }
            });
        }

    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            /*$('#dockingVideoChat').jqxDocking( {
                orientation : 'vertical',
                width: 600,
                mode: 'default',
                theme: 'dark'
            } );

            $('#dockingVideoChat').jqxDocking('showCollapseButton', 'window5');*/
        });
    </script>
    <script type="text/javascript">
        $(function(){
            $('body').contents().eq(0).each(function(){
                if(this.nodeName.toString()=='#text' && this.data.trim().charCodeAt(0)==8203){
                    $(this).remove();
                }
            });
        });
    </script>
</head>
<body class='default'>
    <!-- Header -->
    <div class="top-bar" style="background-color: #0a0a0a; width:100%; padding: 0px; height: 30px; border-bottom-color: #0a73a7; border-bottom-style: solid; border-bottom-width: 2px;">

        <div id="siteLogo" style="height: 30px; width: 250px; float: left; text-align: left; padding-left: 10px; ">
            <p style="color: #FFFFFF; font-size: large; font-weight: bold">MissionKeeper.tv</p>
        </div>

        <div id="audioVideoControls" style="height: 30px; vertical-align: middle; float: left; padding-left: 10px">
            <img src="img/MuteIcon.png" height="15" width="15" onclick="muteVideoChat();">&nbsp;
            <img src="img/VideoChatIcon.png" height="15" width="15" onclick="toggleVideoChatPanel();">&nbsp;
            <img src="img/ShareDesktopIcon.png" height="15" width="15" onclick="shareDesktop();">&nbsp;
            <img src="img/MissionArchive.png" height="15" width="15" onclick="loadStreamArchive();">&nbsp;
            <img src="img/Ellipses.png" height="20" width="15" onclick="loadOptionsPopup();">
        </div>

        <div id="siteSettingsButtons" style="height: 30px; width: 180px; vertical-align: middle; float: right; text-align: right; padding-right: 20px;">
            <img src="img/SchedulerIcon.png" height="15" width="15" onclick="openSchedulerPanel();">&nbsp;&nbsp;
            <img src="img/SettingsIcon.png" height="15" width="15" id="settingsButton">&nbsp;&nbsp;
            <img src="img/FullscreenIcon.png" height="15" width="15" onclick="makeFullScreen();">
        </div>

        <script type="text/javascript">
            function muteVideoChat() {
                //alert("wow1");
            }

            function shareDesktop() {

                // For Google Chrome only, register your extension by ID. You can
                // find it at chrome://extensions once the extension is installed.
                //
                // The last parameter assumes you are using the latest version (version 2)
                // of the OpenTok Chrome extension source code.
                /* OT.registerScreenSharingExtension('chrome', '<YOUR_CHROME_EXTENSION_ID>', 2);


                var desktopPub = OT.initPublisher('camera');
                session.publish(desktopPub, function() {
                    screenshare();
                }); */

               // alert("wow2");
            }

            function loadStreamArchive() {
                //alert("wow3");
            }

            function loadOptionsPopup() {
                //alert("wow4");
            }

            function makeFullScreen() {
               // alert("wow5");
            }

            function toggleSettingsPopup() {
                //alert("wow6");
            }

            function openSchedulerPanel() {
                //alert("wow7");
                $("#scheduleWindow").jqxWindow({maxWidth: 1900, maxHeight: 937, width: 1900, height: 937, theme: 'dark', isModal: true, autoOpen: false, position: { x: 0, y: 0 }});
                $("#scheduleWindow").jqxWindow('open');
            }

            function toggleVideoChatPanel() {
                //alert("wow8");
            }
        </script>

        <div id="popover" style="background-color: #0a0a0a; color: white;">
            <div id="settings">
                <input type="button" value="Account Settings" id='accountSettingsButton' />
                <br /><br />
                <input type="button" value="MissionKeeper Settings" id='missionKeeperSettingsButton' />
                <script type="text/javascript">
                    $("#accountSettingsButton").jqxButton({ width: '200', height: '25', theme: 'dark'});
                    $("#missionKeeperSettingsButton").jqxButton({ width: '200', height: '25', theme: 'dark'});
                </script>
            </div>
        </div>

        <div id='scheduleWindow' style="width: 1850px; height: 1200px" >
            <div>
                MissionKeeper Scheduler
            </div>
            <div>
                <div id="scheduler" class="schedulePanelMission">
                </div>
            </div>
        </div>

    </div>

    <!-- Body  -->
    <div class="container-fluid fillGrid" style="max-height: 900px; background-image: url('img/backgroundImage.png'); background-repeat: no-repeat; background-attachment: fixed; background-position: left;">
        <div class="row-fluid">
            <!-- AudioVideo Chat Controls SideBar  -->
            <div class="fixedGrid">
                <div style="width: 100%; height: 100%; background-color: #262626;">
                    <div id="videoChatParticipantsContainer">
                        <div id="inviteParticipationPopover" style="border-color: white; border-style: solid; border-width: 1px;">
                            <div style="padding-bottom: 5px">
                                <input style="float: left; margin-bottom: 8px" type="text" id="InviteName"/>&nbsp;&nbsp;
                                <input style="float: right; margin-bottom: 8px" type="text" id="InviteRole"/><br/>
                                <input style="float: left; margin-bottom: 10px" type="text" id="InviteEmail"/>&nbsp;&nbsp;
                                <input style="float: right; margin-bottom: 10px"  type="button" value="Go" id='inviteButton' />
                            </div>
                        </div>
                        <div id="attendeesHeader" class="listHeader">
                            <p style="float: left;">Attendees</p><img id="InviteAttendees" style="float: right; margin-right: 5px; height: 18px; width: 22px;" src="img/AddParticipantIcon.png">
                        </div>
                        <div id="participantsHeader" class="listSubHeader">
                            <div style="width: 120px; height: 20px; text-align: center;"><p id="participantHeaderNum" style="width: 10px; float: left;">0</p><p style="width: 40px; float: right;">Participants</p></div>
                        </div>
                        <div id="participantsList" class="scrollbar-9" style="background-color: #262626; width: 240px; overflow-y: auto; height: 180px; padding-top: 8px;">

                        </div>
                        <div id="observersHeader" class="listSubHeader">
                            <div style="width: 120px; height: 20px; text-align: center;"><p style="width: 40px; float: right;">Observers</p></div>
                        </div>
                        <div id="observersList" class="scrollbar-9" style="background-color: #262626; width: 240px; overflow-y: auto; height: 90px">

                        </div>
                    </div>
                    <div id="textChatContainer" style="padding-bottom: 20px; height: 600px;">
                        <div id="chatHeader" class="listHeader">
                            <p style="float: left">Chat</p>
                            <img class="headerImageButtons" src="img/ChatClose.png" onclick="closeChatPanel();">
                            <img class="headerImageButtons" src="img/ChatGroupIndiv.png" onclick="groupIndivChat();">
                            <img class="headerImageButtons" src="img/ChatClear.png" onclick="clearChat();">
                        </div>
                        <div id="chatList" class="scrollbar-9" style="background-color: #262626; overflow-y: auto; height: 340px; padding-left: 0px; padding-top: 8px; margin-left: -20px">

                        </div>
                        <div id="chatEntry" style="text-align: center; width: 100%; padding-left: 20px;">
                            <div class="underspace" id='cmbChatTargets'></div>
                            <br/>
                            <br/>
                            <textarea id="chatSendText" class="scrollbar-9 underspace"></textarea>
                            <br/>
                            <input type="button" value="Submit" id="btnSignal" class="underspace" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Container -->
            <div> <!-- class="hero-unit fillerGrid"> -->
                <div class="videoContainer" id='myElement'>Loading the player...</div>
                    <!--<div id="videoPlayerContainer">
                        <video id="azuremediaplayer" class="azuremediaplayer amp-default-skin amp-big-play-centered" tabindex="0" width="auto" height="837px"></video>
                        &lt;!&ndash; <video width="320" height="240" controls>
                            <source src="https://cdn.liveleak.com/80281E/ll_a_s/2016/Apr/14/LiveLeak-dot-com-312_1460679081-VdeomostramomentoemquefuncionriodaTemTud_1460679074.mp4.h264_720p.mp4?d5e8cc8eccfb6039332f41f6249e92b06c91b4db65f5e99818bdd1964a44d9d28309&ec_rate=230&ec_seek=0" type="video/webm">
                            Your browser does not support the video tag.
                        </video> &ndash;&gt;
                    </div>-->
                    <div id="dockContainer">
                        <!-- Docking Widget - Start -->
                        <div id='jqxWidgetDock'>
                            <div id="docking">
                                <div>
                                    <div id="window0" style="height: 200px">
                                        <div>
                                            STREAMS
                                        </div>
                                        <div id="streamsList" class="scrollbar-9">
                                            No Streams Available...
                                        </div>
                                    </div>
                                    <div id="window1" style="height: 300px">
                                        <div>
                                            <p id="mapPanelHeader">MAP</p>
                                        </div>
                                        <div id="map" style="border:0; vertical-align: middle; text-align: center; width: 150px; height: 450px; overflow: visible;">
                                            <!--  async defer &callback=initMap -->
                                            <script async defer
                                                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRl0RJms6XMDz3Bpfg0NKu0UnSAGBN_g8&libraries=visualization">
                                            </script>
                                        </div>
                                    </div>
                                    <div id="window2" style="height: 560px; padding: 0">
                                        <div>
                                            WEATHER
                                        </div>
                                        <div style="padding: 0; width: 100%; height: 360px; overflow: hidden;">
                                            <div style="padding: 0">
                                                <img src="img/DkZ4j5.gif" width="250">
                                            </div>
                                            <div style="padding: 0; width: 100%; height: 20px; background-color: black; padding-left: 5px;">
                                                <p>Weather Station Data</p>
                                            </div>
                                            <div style="padding: 0; width: 100%; height: 220px; background-color: white">
                                                <img src="img/WeatherStationData.png" >
                                            </div>
                                        </div>
                                    </div>
                                    <div id="window3" style="height: 360px">
                                        <div>
                                            DEVICE INFO
                                        </div>
                                        <div style="padding: 0; width: 100%; height: 100px;">
                                            <img src="img/DeviceStatus.png" >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Panel - Video Chat -->
                    <div id="videoChatContainer">
                        <!-- Docking Widget - Start -->
                        <div id='jqxWidgetDock_2'>
                            <!-- <div id="dockingVideoChat">
                                <div>
                                    <div id="window5" style="height: 150px">
                                        <div>
                                            VIDEO CHAT
                                        </div>
                                        <div id="talkingHeadsContainer">

                                        </div>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                        <!-- Docking Widget - End -->
                    </div>
                    <div id="contentFooter" class="container-fluid fillGrid" style="height: 30px; background-color: black; color: white; opacity: 0.8; padding-left: 20px; font-size: smaller; vertical-align: middle">
                        MissionCaster.TV • © 2015 • All Rights Reserved • Terms of Use • Privacy Policy
                    </div>
            </div>
        </div>
    </div>
    <div>
        <script>

            var missionID = getParameterByName('Id');
            var missionName = getParameterByName('Name');
            var vUserName = sessionStorage.getItem( "username" );
            var vRole = sessionStorage.getItem( "roleName" );
            var vMissionData;
            var map;
            var qtyParticipants = 0;
            var qtyObservers = 0;

            var session;
            var publisher;
            var desktopPub;

            /* Telemetry timer */
            var telemetryTimer;
            var timerFired = 0;
            var timerInterval = 3000;
            var flightPath;
            var droneMarkers = [];

            if (vUserName == "null") {
                vUserName = getParameterByName('userName');
            }

            if (vRole == "null") {
                vRole = getParameterByName('role');
            }

            document.title = missionName + ' Mission (' + missionID + ')';

            setupMission(missionID);

            function setupMission(missionID) {

                var apiKey = null;

                var uriMission = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + missionID;
                $.getJSON(uriMission, function(missionData)  {

                    vMissionData = missionData;

                    apiKey = missionData.ApiKey;

                    var uriToken = "http://missionkeeperdemosite.azurewebsites.net//api/session/mission/" +  missionID + "/username/" + vUserName + "/role/" + vRole ;

                    setupStreams(missionData.VideoStreams);

                    for ( let missionStream of missionData.VideoStreams  ) {

                        if ( missionStream.IsDefault == true) {
                            setupPlayer(missionStream);
                            // Setup the Telemetry update timer
                            synchronizeTelemetry(missionStream.StreamID);
                        }
                    }

                    setupInvite(missionData.Roles);

                    $.getJSON(uriToken, function (tokenData) {

                            if(!tokenData) {
                                alert("No mission data available");
                            }
                            else {
                                setupSession( apiKey, tokenData.SessionID, tokenData.Token);
                            }

                        })
                        .fail(function( jqxhr, textStatus, error ) {
                            var err = textStatus + ", " + error;
                            console.log( "Request Failed: " + err );
                            return;
                        })
                        .always(function() {
                            console.log( "completed" );
                        });

                } );

            }

            function setupStreams( streamsData ) {

                if ( streamsData.length == 0 ) {
                    return;
                }

                var streamsElement = document.getElementById("streamsList");  //  List of all the streams for this mission
                {
                    /* Clear the Nodes from the list */
                    var last;
                    while (last = streamsElement.lastChild) streamsElement.removeChild(last);
                }

                for( let tStream of streamsData ) {

                    // streamDiv - Width: 100%;
                        // thumbDiv - Float: left;
                            // thumbNode
                        // streamInfoDiv - Float: right;
                            // streamIDTitleNode
                                // streamIDTitleText
                            // streamIDNode
                                // streamIDText
                            // nameTitleNode
                                // nameTitleText
                            // streamNameNode
                                // streamNameText
                            // platformTitleNode
                                // platformTitleText

                    console.log( "stream " + tStream.Name );

                    // Create Stream Title Bar Div
                    var streamTitleBar = document.createElement("div");
                    streamTitleBar.className += " streamTitleBarDiv";

                    // Create the Stream Name Node******************************************
                    var streamNameNode = document.createElement("p");
                    streamNameNode.className += " streamNameNode";
                    var nameText = document.createTextNode( tStream.Name );

                    //var nameNode = document.createTextNode( tStream.Name );
                    streamNameNode.appendChild(nameText);
                    streamTitleBar.appendChild(streamNameNode);

                    // Add streamTitleBar to streamsElement
                    streamsElement.appendChild(streamTitleBar);

                    // Create Divs for all the Stream elements******************************
                    // Create a Div for each stream
                    var streamDiv = document.createElement("div");
                    streamDiv.className += " streamDiv";
                    streamDiv.setAttribute("data-streamID", tStream.StreamID );

                    // Thumbnail Div float left
                    var thumbDiv = document.createElement("div");
                    thumbDiv.className += " thumbDiv";

                    // streamInfo Div float right
                    var streamInfoDiv = document.createElement("div");
                    streamInfoDiv.className += " streamInfoDiv";


                    // Create the Stream ID Title Node***************************************
                    var streamIDTitleNode = document.createElement("p");
                    streamIDTitleNode.className += " streamTitleNode";
                    var IDtitleText = document.createTextNode( "Stream ID:" );
                    var IDtitleBR = document.createElement("br");

                    streamIDTitleNode.appendChild(IDtitleText);
                    streamInfoDiv.appendChild(streamIDTitleNode);
                    streamInfoDiv.appendChild(IDtitleBR);

                    // Create the Stream ID Node..
                    var streamIDNode = document.createElement("p");
                    streamIDNode.className += " streamNode";
                    var IDtext = document.createTextNode( tStream.StreamID );
                    var IDBR = document.createElement("br");

                    // Add IDtext to Stream ID to Stream Info Div
                    //var nameNode = document.createTextNode( tStream.Name );
                    streamIDNode.appendChild(IDtext);
                    streamInfoDiv.appendChild(streamIDNode);
                    streamInfoDiv.appendChild(IDBR);

                    // Create the Stream Platform Title Node*********************************
                    var streamPlatformTitleNode = document.createElement("p");
                    streamPlatformTitleNode.className += " streamTitleNode";
                    var streamPlatformTitleText = document.createTextNode( "Stream Platform:" );
                    var platformTitleBR = document.createElement("br");

                    streamPlatformTitleNode.appendChild(streamPlatformTitleText);
                    streamInfoDiv.appendChild(streamPlatformTitleNode);
                    streamInfoDiv.appendChild(platformTitleBR);

                    // Create the Stream Platform Node..
                    var streamPlatformNode = document.createElement("p");
                    streamPlatformNode.className += " streamNode";
                    var streamPlatformText = document.createTextNode( tStream.Platform );
                    var platformBR = document.createElement("br");

                    //var platformNode = document.createTextNode( tStream.Platform );
                    streamPlatformNode.appendChild(streamPlatformText);
                    streamInfoDiv.appendChild(streamPlatformNode);
                    streamInfoDiv.appendChild(platformBR);

                    // Add the streamInfoDIV to the streamDiv*******************************
                    streamDiv.appendChild(streamInfoDiv);

                    // Add the Thumbnail Image to thumbNode to thumbDiv *******************
                    var thumbNode = document.createElement("img");
                    thumbNode.className += " streamThumb";

                    thumbNode.setAttribute("src", tStream.ThumbnailURI );

                    thumbNode.addEventListener('click', function(){
                        switchStream(tStream.StreamID);
                    });

                    thumbDiv.appendChild(thumbNode);
                    streamDiv.appendChild(thumbDiv);

                    streamsElement.appendChild(streamDiv);
                }
            }

            function setupInvite( inviteRoles ) {

                // Invite new attendees  popup
                $("#inviteParticipationPopover").jqxPopover({offset: {left: 5, top:40}, arrowOffsetValue: -240, position: "right", theme: "dark", title: "Invite Someone to This Mission", showCloseButton: true, selector: $("#InviteAttendees") });
                $("#InviteName").jqxInput({placeHolder: "Invitee Name", height: 25, width: 150, minLength: 1});
                $("#InviteRole").jqxInput({placeHolder: "Invitee Role", height: 25, width: 120, minLength: 1, searchMode: 'containsignorecase', source: inviteRoles});
                $("#InviteEmail").jqxInput({placeHolder: "Enter email address", height: 25, width: 250, minLength: 1});//,  source: countries
                $("#inviteButton").jqxButton({ width: 25, height: 25, theme: 'dark' });

                $("#inviteButton").click(function () {

                    var inviteName = document.getElementById('InviteName');
                    var inviteRole = document.getElementById('InviteRole');
                    var inviteEmail = document.getElementById('InviteEmail');
                    // Build URI to get JSON from
                    var uriInviteEmail = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + missionID + "/username/" + inviteName.value + "/role/" + inviteRole.value + "/email/" + inviteEmail.value + "/";

                    //Get JSON telemetry and call new timer
                    $.getJSON(uriInviteEmail, function (result) {
                        console.log("Invitation : " + result);
                    });

                    inviteName.value = "";
                    inviteRole.value = "";
                    inviteEmail.value = "";

                    $('#inviteParticipationPopover').jqxPopover('close');

                });

            }

            function  setupSession( apikey, sessionid, token ) {

                console.log( "ApiKey " + apikey );
                console.log( "SessionId " + sessionid);

                session = OT.initSession(apikey, sessionid);

                var pubProps = {fitMode: "cover", height: "110px", width: "110px", name: vUserName, insertMode: "append", showControls: true };

                publisher = OT.initPublisher('talkingHeadsContainer', pubProps, function (error) {
                    if (error) {
                        console.log(error);
                    } else {
                        console.log("Publisher initialized.");
                    }
                });

                session.connect( token, function( err ) {

                    if (err) {
                        alert("Token Expired");
                        publisher.destroy();
                        publisher = null;
                    }
                    else {
                        session.publish(publisher, function (err) {
                            if (err) {

                                if (err.code === 1553 || (err.code === 1500 && err.message.indexOf("Publisher PeerConnection Error:") >= 0)) {
                                    showMessage("Streaming connection failed. This could be due to a restrictive firewall.");
                                }
                                else {
                                    showMessage("An unknown error occurred while trying to publish your video. Please try again later.");
                                }
                                publisher.destroy();
                                publisher = null;

                            }
                        });
                    }
                } ) ;

                session.on("connectionCreated", function(event) {

                    var tUserName =  getUsername(event.connection.data);

                    if (tUserName == "null") {
                        tUserName = getParameterByName('userName');; //Bookmark
                    }

                    // Add new participant to the Chat combobox
                    $("#cmbChatTargets").jqxComboBox('addItem', tUserName);

                    // Increment the qty of participants number in Participants header
                    document.getElementById("participantHeaderNum").innerHTML = ++qtyParticipants;


                    var participantsElement = document.getElementById("participantsList");

                    // Create a div
                    var paraRow = document.createElement("div");

                    // Add a Class
                    paraRow.className += " paraRow";

                    // Create a Div
                    var paraName = document.createElement("div");

                    // Add a Class
                    paraName.className += " paraName";
                    //var particpntNode = document.createElement("p");
                    var particpntNode = document.createTextNode( tUserName );
                    paraName.appendChild(particpntNode);

                    // Add to first Div
                    paraRow.appendChild(paraName);

                    // Create a Div
                    var paraButtons = document.createElement("div");
                    //paraButtons.className += " paraButtonsDiv";
                    var dropButton = document.createElement("img");
                    dropButton.setAttribute('src', 'img/disableChatIcon.png');
                    dropButton.className += " paraButtons";
                    var muteButton = document.createElement("img");
                    muteButton.setAttribute('src', 'img/participantsMuteIcon.png');
                    muteButton.className += " paraButtons";
                    paraButtons.appendChild(dropButton);
                    var imgSpace = document.createTextNode("    ");
                    paraButtons.appendChild(imgSpace);
                    //paraButtons.appendChild(imgSpace2);
                    paraButtons.appendChild(muteButton);

                    // Add to first Div
                    paraRow.appendChild(paraButtons);

                    participantsElement.appendChild(paraRow);

                });

                session.on("streamCreated", function(event) {

                    console.log( "Stream Created" ) ;

                    var subParams = {fitMode: "cover", height: "110px", width: "110px", name: "subKarl", insertMode: "append", showControls: true};
                    subscriber = session.subscribe(event.stream, "talkingHeadsContainer", subParams );
                });

                session.on("signal", function(event) {

                    var tUserName =  getUsername(event.from.data);
                    console.log("Signal Received: " + event.data + " (" + tUserName + ")" );

                    // Create text chat & Participants name div containers
                    var paraContainer = document.createElement("div");
                    var nameContainer = document.createElement("div");
                    paraContainer.className += " chatterContainer";
                    nameContainer.className += " chatterNameContainer";

                    // Create newline element
                    var newline = document.createElement("br");

                    // Create chatter's name element
                    var chatter = document.createElement("p");
                    chatter.className += " chatterName";

                    // Create chat text element
                    var para = document.createElement("p");
                    para.className += " chatText";

                    // var chatterNode = document.createTextNode( tUserName + ' (' + vRole + ')' );
                    var chatterNode = document.createTextNode( tUserName  );
                    chatter.appendChild(chatterNode);

                    // Append chat text to "p" element
                    var node = document.createTextNode(event.data);
                    para.appendChild(node);

                    // Append chat text element to container div
                    nameContainer.appendChild(chatter);

                    // Append chat text element to container div
                    nameContainer.appendChild(para);

                    var chatterElement = document.getElementById("chatList");
                    chatterElement.appendChild(nameContainer);

                    var element = document.getElementById("chatList");
                    element.appendChild(paraContainer);

                    // Keeps div scrolled to the bottom so incoming chats can be seen
                    var objDiv = document.getElementById("chatList");
                    objDiv.scrollTop = objDiv.scrollHeight;
                });

                publisher.on({
                    accessAllowed: function (event) {
                        // The user has granted access to the camera and mic.
                        console.log("Granted: camera and mic.");
                    },
                    accessDenied: function accessDeniedHandler(event) {
                        // The user has denied access to the camera and mic.
                        console.log("Denied: camera and mic.");
                    }
                });

            }

            function getUsername(fromData) {

                var x = fromData.split(',')[0];
                var y = x.split('=')[1];
                return y;

            }

            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)", "i"),
                        results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            function screenshare() {
                OT.checkScreenSharingCapability(function(response) {
                    if (!response.supported || response.extensionRegistered === false) {
                        alert('This browser does not support screen sharing.');
                    } else if (response.extensionInstalled === false) {
                        alert('Please install the screen sharing extension and load your app over https.');
                    } else {
                        // Screen sharing is available. Publish the screen.
                        var screenSharingPublisher = OT.initPublisher('screen-preview', {videoSource: 'screen'});
                        session.publish(screenSharingPublisher, function(error) {
                            if (error) {
                                alert('Could not share the screen: ' + error.message);
                            }
                        });
                    }
                });
            }

            $('#btnSignal').on('click', function (event) {

                var btnSig = document.getElementById("btnSignal");

                var signalData = document.getElementById('chatSendText').value;

                if ("" == signalData ) {
                    // If the signalData is an String.Empty just exit out and don't send the text.
                    return;
                }

                document.getElementById('chatSendText').value = "";

                session.signal(
                    {
                        data: signalData
                    },
                    function (error) {
                        if (error) {
                            console.log("signal error ("
                                    + error.code
                                    + "): " + error.message);
                        } else {
                            console.log("Signal sent : " + signalData);
                        }
                    });
            });

            function onBtnClick() {

                var btnSig = document.getElementById("btnSignal");

                var signalData = document.getElementById('chatSendText').value;

                if ("" == signalData ) {
                    // If the signalData is an String.Empty just exit out and don't send the text.
                    return;
                }

                document.getElementById('chatSendText').value = "";

                btnSig.value = signalData;

                session.signal(
                    {
                        data: signalData
                    },
                    function (error) {
                        if (error) {
                            console.log("signal error ("
                                    + error.code
                                    + "): " + error.message);
                        } else {
                            console.log("Signal sent : " + signalData);
                        }
                    });
            }

            function switchStream(streamID) {

                console.log( "Switch to stream " + streamID);

                for ( let missionStream of vMissionData.VideoStreams  ) {

                    if ( missionStream.StreamID == streamID) {
                        setupPlayer(missionStream);
                        synchronizeTelemetry(missionStream.StreamID);
                    }
                }

            }

            function setupPlayer(streamData) {


                /*   This is the code for the AzureMedia Player (AMP)
                *
                    var myOptions = {
                        "nativeControlsForTouch": false,
                        controls: false,
                        autoplay: true,
                        logo: { enabled: false }
                    };
                    myPlayer = amp("azuremediaplayer", myOptions);
                    myPlayer.src([
                        {
                            "src": streamData.VideoURI,
                            "type": "video/mp4"
                        }
                    ]);
                */
                /*  This is the code for the jwplayer D0gMpfYS4+zwogqhtfmcPYRwXgcduLHyfSMsnysJlP4= */
                jwplayer.key = "D0gMpfYS4+zwogqhtfmcPYRwXgcduLHyfSMsnysJlP4=";
                jwplayer("myElement").setup({
                    file: streamData.VideoURI,
                    image: streamData.ThumbnailURI,
                    width: "100%",
                    aspectratio: "16:9",
                    autostart: 'true',
                    controlbar: 'none'});

                /*  This is the code for the jwplayer D0gMpfYS4+zwogqhtfmcPYRwXgcduLHyfSMsnysJlP4= */
                /*var streamURI = "/videos/SpinAroundThe Neighborhood.mp4";

                jwplayer.key = "D0gMpfYS4+zwogqhtfmcPYRwXgcduLHyfSMsnysJlP4=";
                jwplayer("myElement").setup({
                    file: streamURI,
                    image: streamData.ThumbnailURI,
                    width: "100%",
                    aspectratio: "16:9",
                    autostart: 'true',
                    controlbar: 'none'});*/
            }


            function synchronizeTelemetry( streamID ) {

                if ( telemetryTimer == null ) {
                    setupTelemTimer(streamID);
                }

                updateTelemetry( elapsedTime() );


                /* This is a closure that belongs inside synchronizeTelemetry.  What is does is
                 * set up a timer to continuously call its parent (synchronizeTelemetry)
                  * */
                function setupTelemTimer(streamID) {

                    telemetryTimer = setInterval(function(){ synchronizeTelemetry(streamID) }, timerInterval);

                    /*  Call the updateMap function once in order to get the initial position */
                    timerFired = -timerInterval;

                }

                function elapsedTime() {

                    // Get video count Extra comment
                    //var vPlayer = document.getElementById('azuremediaplayer');
                    //var currTimeCode = vPlayer.player.mediaplayer.currentAbsoluteTime();


                /*  This code was used with the Azure Media Player (AMP).   It was necessary
                 *  to use a timer because the AMP did not behave as indicated in the documentation
                 *  in so far as it failed to return the position time when called.
                 *
                 *   var rtnTime = timerFired / 1000;
                 *   timerFired += timerInterval;
                 *   return rtnTime;
                 */

                    return jwplayer("myElement").getPosition();
                }

                function updateTelemetry( elapsedTime ){

                    // Build URI to get JSON from
                    var uriStreamTelemetry = "http://missionkeeperdemoapi.azurewebsites.net/api/mission/" + missionID + "/stream/" + streamID + "/flightpath/" + elapsedTime + "/";

                    console.log("Updating Telemerty : " +  elapsedTime);

                    //Get JSON telemetry and call new timer
                    $.getJSON(uriStreamTelemetry, function (telemData) {

                        if(telemData.length > 0 ) {

                            updateMap(telemData);

                            var telemItem = telemData[telemData.length - 1];
                            UpdateLocaltime(telemItem);

                        }
                    });

                }

                /* This is a closure that belongs inside synchronizeTelemetry */
                function updateMap( telemData ) {
                    if( flightPath != null ) {
                        flightPath.setMap(null);
                    }

                    var droneIcon = 'img/DroneIcon.png';

                    lastTelem =  telemData[ telemData.length - 1 ];
                    //droneMarker.setMap(null);

                    if( map != null ) {

                        // Remove the marker from the map
                        setMapOnAll(null);

                        // Delete the markers fro the array
                        droneMarkers = [];

                        // loop through json and find telemdata for cooresponding video count
                        flightPath = new google.maps.Polyline({
                            path: telemData,
                            strokeColor: '#FF0000',
                            strokeOpacity: 1.0,
                            strokeWeight: 3,
                            map: map
                        });

                        // placeMarker at take-off point
                        var droneMarker = new google.maps.Marker({
                            position: {lat: lastTelem.lat, lng:  lastTelem.lng},
                            map: map,
                            title: 'Drone Position',
                            icon: droneIcon
                        });

                        droneMarkers.push(droneMarker);
                        droneMarkers[0].setMap(map);

                        flightPath.setMap(map);

                        map.setCenter(lastTelem, map.zoom);

                        var latLong = "[" + lastTelem.lat + "," + lastTelem.lng + "]";
                        var mapHeaderText = document.getElementById('mapPanelHeader');
                        mapHeaderText.innerHTML =  "MAP " + latLong;


                        console.log( "Center Map : " + lastTelem.lat + "," + lastTelem.lng );
                    }
                    else {
                        initMap2(lastTelem.lat, lastTelem.lng);
                    }
                }

            }

            // Sets the map on all markers in the array.
            function setMapOnAll(map) {
                for (var i = 0; i < droneMarkers.length; i++) {
                    droneMarkers[i].setMap(map);
                }
            }

            function initMap(){

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 12,
                    center: {lat:36.586246, lng:-79.391800},
                    mapTypeId: google.maps.MapTypeId.TERRAIN
                });
            }

            function initMap2(lat, lng) {

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 16,
                    center: {lat: lat, lng:  lng},
                    mapTypeId: google.maps.MapTypeId.TERRAIN
                });

                var image = 'img/flag-green-icon.png';
                var droneIcon = 'img/DroneIcon.png';


                // placeMarker at take-off point
                var marker = new google.maps.Marker({
                    position: {lat: lat, lng:  lng},
                    map: map,
                    title: 'Mission Origin',
                    icon: image
                });
            }

            function UpdateLocaltime(telemItem) {
                var  localTime = telemItem.LocalTime;
                console.log("Logal Time : " + localTime );
            }

            function closeChatPanel() {
                //alert("Close Chat Panel");
            }

            function groupIndivChat() {
               // alert("Group/Individual");
            }

            function clearChat() {
                //chatList
                var mChatList = document.getElementById("chatList");
                while (mChatList.firstChild) {
                    mChatList.removeChild(mChatList.firstChild);
                }
            }

        </script>
        <script type="text/javascript">

        </script>
    </div>

    <!--Import jQuery before materialize.js-->

    <script type="text/javascript" src="js/materialize.min.js"></script>

    <!--Import jQuery before foundation-->

    <script src="js/vendor/what-input.min.js"></script>
    <script src="js/foundation.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        $(document).foundation();
    </script>

</body>
</html>